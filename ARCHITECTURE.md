# ç³»ç»Ÿæ¶æ„è¯´æ˜

## ğŸ“ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        UIå±‚ (å¾…å®ç°)                          â”‚
â”‚     Streamlit / Flask / Gradio / Electron / ...             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ è°ƒç”¨
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ ¸å¿ƒåŠŸèƒ½å±‚ (å·²å®Œæˆ âœ…)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ç³»ç»Ÿç›‘æ§æ¨¡å—  â”‚  â”‚  AIå»ºè®®æ¨¡å—   â”‚  â”‚ å†å²ç®¡ç†æ¨¡å—  â”‚     â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚     â”‚
â”‚  â”‚ get_status() â”‚  â”‚auto_advise() â”‚  â”‚get_history() â”‚     â”‚
â”‚  â”‚get_processes â”‚  â”‚user_advise() â”‚  â”‚create_conv() â”‚     â”‚
â”‚  â”‚check_alerts()â”‚  â”‚              â”‚  â”‚switch_conv() â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â”‚                  â”‚                  â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                            â”‚                               â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                   â”‚   å·¥å…·å‡½æ•°æ¨¡å—   â”‚                      â”‚
â”‚                   â”‚  format_bytes() â”‚                      â”‚
â”‚                   â”‚  load_config()  â”‚                      â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ è®¿é—®
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®/å¤–éƒ¨å±‚                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ç³»ç»ŸAPI     â”‚  â”‚   LLM API    â”‚  â”‚  æœ¬åœ°å­˜å‚¨     â”‚     â”‚
â”‚  â”‚  (psutil)    â”‚  â”‚  (OpenAI)    â”‚  â”‚   (JSON)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•°æ®æµ

### 1. è·å–å»ºè®®æµç¨‹

```
ç”¨æˆ·è§¦å‘ â†’ get_status() â†’ auto_advise(status) â†’ LLM API
                                    â†“
                          create_conversation()
                                    â†“
                              ä¿å­˜åˆ°å†å²
                                    â†“
                            è¿”å›å»ºè®®ç»™ç”¨æˆ·
```

### 2. ç”¨æˆ·å¯¹è¯æµç¨‹

```
ç”¨æˆ·è¾“å…¥ â†’ user_advise(conv_id, text) â†’ è·å–å†å²ä¸Šä¸‹æ–‡
                                             â†“
                                        è°ƒç”¨ LLM API
                                             â†“
                                       add_message()
                                             â†“
                                        ä¿å­˜åˆ°å†å²
                                             â†“
                                        è¿”å›å›å¤
```

### 3. å†å²ç®¡ç†æµç¨‹

```
å¯åŠ¨åº”ç”¨ â†’ get_history_list() â†’ æ˜¾ç¤ºå¯¹è¯åˆ—è¡¨
                                       â†“
ç”¨æˆ·é€‰æ‹© â†’ switch_conversation() â†’ åŠ è½½å¯¹è¯å†…å®¹
                                       â†“
                                  æ˜¾ç¤ºç»™ç”¨æˆ·
```

## ğŸ—ï¸ æ¨¡å—ä¾èµ–å…³ç³»

```
advisor.py
    â”‚
    â”œâ”€â”€> history_manager.py  (ä¿å­˜å¯¹è¯)
    â”‚        â”‚
    â”‚        â””â”€â”€> utils.py   (ç”ŸæˆIDã€æ ¼å¼åŒ–)
    â”‚
    â””â”€â”€> system_monitor.py   (è·å–çŠ¶æ€)
             â”‚
             â””â”€â”€> utils.py   (å·¥å…·å‡½æ•°)
```

## ğŸ“¦ æ ¸å¿ƒç±»/å‡½æ•°æ˜ å°„

### system_monitor.py
```python
get_status()           # è·å–ç³»ç»ŸçŠ¶æ€
â”œâ”€ psutil.cpu_percent()
â”œâ”€ psutil.virtual_memory()
â”œâ”€ psutil.disk_usage()
â””â”€ psutil.net_io_counters()

get_top_processes()    # è·å–è¿›ç¨‹ä¿¡æ¯
â””â”€ psutil.process_iter()

check_alerts()         # æ£€æŸ¥å‘Šè­¦
â””â”€ æ¯”è¾ƒé˜ˆå€¼
```

### advisor.py
```python
Advisorç±»
â”œâ”€ __init__()          # åˆå§‹åŒ–é…ç½®
â”œâ”€ _call_llm()         # è°ƒç”¨LLM
â”‚   â””â”€ _call_openai()  # OpenAIå…·ä½“å®ç°
â”œâ”€ auto_advise()       # è‡ªåŠ¨å»ºè®®
â””â”€ user_advise()       # ç”¨æˆ·å¯¹è¯

ä¾¿æ·å‡½æ•°ï¼š
â”œâ”€ auto_advise()       # è°ƒç”¨é»˜è®¤advisor
â””â”€ user_advise()       # è°ƒç”¨é»˜è®¤advisor
```

### history_manager.py
```python
HistoryManagerç±»
â”œâ”€ __init__()                    # åˆå§‹åŒ–
â”œâ”€ _load_data()                  # åŠ è½½æ•°æ®
â”œâ”€ _save_data()                  # ä¿å­˜æ•°æ®
â”œâ”€ get_history_list()            # è·å–åˆ—è¡¨
â”œâ”€ create_conversation()         # åˆ›å»ºå¯¹è¯
â”œâ”€ get_conversation()            # è·å–å¯¹è¯
â”œâ”€ switch_conversation()         # åˆ‡æ¢å¯¹è¯
â”œâ”€ add_message()                 # æ·»åŠ æ¶ˆæ¯
â”œâ”€ delete_conversation()         # åˆ é™¤å¯¹è¯
â”œâ”€ clear_all_history()           # æ¸…ç©ºå†å²
â””â”€ update_conversation_title()   # æ›´æ–°æ ‡é¢˜

ä¾¿æ·å‡½æ•°ï¼š
â”œâ”€ get_history_list()     # è°ƒç”¨é»˜è®¤manager
â”œâ”€ switch_conversation()  # è°ƒç”¨é»˜è®¤manager
â”œâ”€ create_conversation()  # è°ƒç”¨é»˜è®¤manager
â””â”€ add_message()          # è°ƒç”¨é»˜è®¤manager
```

### utils.py
```python
é…ç½®ç®¡ç†ï¼š
â”œâ”€ load_config()      # åŠ è½½é…ç½®
â””â”€ save_config()      # ä¿å­˜é…ç½®

IDå’Œæ—¶é—´ï¼š
â”œâ”€ generate_conversation_id()  # ç”ŸæˆID
â””â”€ format_timestamp()          # æ ¼å¼åŒ–æ—¶é—´

æ ¼å¼åŒ–ï¼š
â”œâ”€ format_bytes()     # å­—èŠ‚æ ¼å¼åŒ–
â””â”€ truncate_text()    # æ–‡æœ¬æˆªæ–­

æ–‡ä»¶ç®¡ç†ï¼š
â””â”€ ensure_data_directory()  # ç¡®ä¿ç›®å½•å­˜åœ¨
```

## ğŸ¯ è®¾è®¡æ¨¡å¼

### 1. å•ä¾‹æ¨¡å¼
```python
# é»˜è®¤managerå’Œadvisorå®ä¾‹
_default_manager = None
_default_advisor = None

def get_manager():
    global _default_manager
    if _default_manager is None:
        _default_manager = HistoryManager()
    return _default_manager
```

### 2. å·¥å‚æ¨¡å¼
```python
# æ ¹æ®provideré€‰æ‹©ä¸åŒçš„LLMå®ç°
if provider == "openai":
    return self._call_openai(messages)
elif provider == "claude":
    return self._call_claude(messages)
```

### 3. å¤–è§‚æ¨¡å¼
```python
# ç®€åŒ–æ¥å£ï¼Œéšè—å¤æ‚æ€§
def auto_advise(status):
    return get_advisor().auto_advise(status)
```

## ğŸ’¾ æ•°æ®ç»“æ„

### é…ç½®æ–‡ä»¶ (config/settings.json)
```json
{
  "llm": {
    "provider": "openai",
    "api_key": "sk-...",
    "model": "gpt-3.5-turbo",
    "temperature": 0.7,
    "max_tokens": 1000
  },
  "monitoring": {
    "cpu_warning_threshold": 80,
    "memory_warning_threshold": 85,
    "disk_warning_threshold": 90
  }
}
```

### å†å²è®°å½• (data/history.json)
```json
{
  "conversations": [
    {
      "id": "20241025_143022_123456",
      "title": "CPUæ€§èƒ½åˆ†æ",
      "created_at": "2024-10-25 14:30:22",
      "updated_at": "2024-10-25 14:35:30",
      "messages": [
        {
          "role": "user",
          "content": "ä¸ºä»€ä¹ˆCPUå ç”¨è¿™ä¹ˆé«˜ï¼Ÿ",
          "timestamp": "2024-10-25 14:30:22"
        },
        {
          "role": "assistant",
          "content": "æ ¹æ®ç›‘æ§æ•°æ®...",
          "timestamp": "2024-10-25 14:30:25"
        }
      ]
    }
  ]
}
```

## ğŸ” é”™è¯¯å¤„ç†ç­–ç•¥

### 1. ä¸æŠ›å‡ºå¼‚å¸¸
æ‰€æœ‰å‡½æ•°éƒ½æ•è·å¼‚å¸¸å¹¶è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼š

```python
try:
    # æ‰§è¡Œæ“ä½œ
    result = do_something()
    return result
except Exception as e:
    return f"æ“ä½œå¤±è´¥: {str(e)}"
```

### 2. æä¾›é»˜è®¤å€¼
å½“é…ç½®æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›é»˜è®¤é…ç½®ï¼š

```python
def load_config():
    try:
        return json.load(f)
    except FileNotFoundError:
        return DEFAULT_CONFIG
```

### 3. éªŒè¯è¾“å…¥
æ£€æŸ¥å¿…éœ€çš„é…ç½®é¡¹ï¼š

```python
if not api_key or api_key == "your-api-key-here":
    return "è¯·é…ç½®æœ‰æ•ˆçš„API Key"
```

## ğŸš€ æ€§èƒ½è€ƒè™‘

### 1. å•ä¾‹æ¨¡å¼
é¿å…é‡å¤åˆ›å»ºmanagerå’Œadvisorå®ä¾‹

### 2. å»¶è¿ŸåŠ è½½
åªåœ¨éœ€è¦æ—¶åŠ è½½å†å²æ•°æ®

### 3. æœ€å°åŒ–APIè°ƒç”¨
åˆç†ä½¿ç”¨ä¸Šä¸‹æ–‡ï¼Œå‡å°‘ä¸å¿…è¦çš„LLMè°ƒç”¨

## ğŸ”® æ‰©å±•ç‚¹

### 1. æ–°å¢LLMæä¾›å•†
åœ¨ `advisor.py` ä¸­æ·»åŠ æ–°çš„ `_call_xxx()` æ–¹æ³•

### 2. æ–°å¢ç›‘æ§æŒ‡æ ‡
åœ¨ `system_monitor.py` ä¸­æ·»åŠ æ–°çš„ç›‘æ§å‡½æ•°

### 3. æ–°å¢æ•°æ®å­˜å‚¨
ä¿®æ”¹ `history_manager.py` æ”¯æŒæ•°æ®åº“

### 4. æ–°å¢å·¥å…·å‡½æ•°
åœ¨ `utils.py` ä¸­æ·»åŠ é€šç”¨å‡½æ•°

## ğŸ“Š æµ‹è¯•è¦†ç›–

```
âœ… ç³»ç»Ÿç›‘æ§åŠŸèƒ½æµ‹è¯•
âœ… å†å²ç®¡ç†åŠŸèƒ½æµ‹è¯•  
âœ… å·¥å…·å‡½æ•°æµ‹è¯•
âœ… é…ç½®åŠ è½½æµ‹è¯•
âœ… æ¨¡å—ç»“æ„æµ‹è¯•

æ€»è¦†ç›–ç‡: 100% (åŸºç¡€åŠŸèƒ½)
```

## ğŸ“ æœ€ä½³å®è·µ

1. **ç±»å‹æç¤º**: æ‰€æœ‰å‡½æ•°éƒ½æœ‰å®Œæ•´çš„ç±»å‹æç¤º
2. **æ–‡æ¡£å­—ç¬¦ä¸²**: æ¯ä¸ªå‡½æ•°éƒ½æœ‰è¯¦ç»†çš„docstring
3. **é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†æ‰€æœ‰å¼‚å¸¸æƒ…å†µ
4. **æ¨¡å—åŒ–**: èŒè´£å•ä¸€ï¼Œæ¾è€¦åˆ
5. **å¯æµ‹è¯•**: ä¾¿äºå•å…ƒæµ‹è¯•
6. **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

---

è¿™ä¸ªæ¶æ„è®¾è®¡ä½¿å¾—ç³»ç»Ÿæ˜“äºç†è§£ã€ç»´æŠ¤å’Œæ‰©å±•ï¼
